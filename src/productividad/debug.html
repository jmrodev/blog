<h1>Depuración avanzada con nvim-dap, launch.json y Docker/SSH</h1>
<section>
  <h2>Enlaces rápidos</h2>
  <ul>
    <li><a href="atajos.html">← Volver a atajos y productividad</a></li>
    <li><a href="../index.html">← Volver al índice principal</a></li>
  </ul>
  <h2>¿Qué es nvim-dap?</h2>
  <p>nvim-dap es el sistema de depuración para Neovim, compatible con el Debug Adapter Protocol (DAP), similar a la experiencia de VSCode.</p>
  <h2>¿Cómo usar launch.json en Neovim?</h2>
  <ol>
    <li>Crea un archivo <code>.vscode/launch.json</code> en tu proyecto.</li>
    <li>Ejecuta en Neovim:<br><code>:lua require('dap.ext.vscode').load_launchjs()</code></li>
    <li>Opcional: Mapea este comando a una tecla junto a <code>DapContinue</code> para cargar la config antes de depurar.</li>
  </ol>
  <h2>Ejemplo de mappings de teclas para depuración</h2>
  <pre>local dap = require('dap')
local map = vim.keymap.set
map('n', '<F5>', dap.continue, { desc = 'Iniciar/Continuar depuración' })
map('n', '<F10>', dap.step_over, { desc = 'Step Over' })
map('n', '<F11>', dap.step_into, { desc = 'Step Into' })
map('n', '<F12>', dap.step_out, { desc = 'Step Out' })
map('n', '<Leader>b', dap.toggle_breakpoint, { desc = 'Toggle Breakpoint' })
map('n', '<Leader>B', function() dap.set_breakpoint(vim.fn.input('Condición: ')) end, { desc = 'Breakpoint condicional' })
map('n', '<Leader>lp', function() dap.set_breakpoint(nil, nil, vim.fn.input('Log: ')) end, { desc = 'Breakpoint de log' })
map('n', '<Leader>dr', dap.repl.open, { desc = 'Abrir REPL' })
map('n', '<Leader>dl', dap.run_last, { desc = 'Ejecutar última sesión' })
map('n', '<Leader>dv', function() require('dap.ui.variables').hover() end, { desc = 'Ver variable bajo cursor' })
map('n', '<Leader>dc', ":lua require('dap.ext.vscode').load_launchjs()<CR>", { desc = 'Cargar launch.json' })
</pre>
  <h2>Diagrama visual: Flujo de debugging en Neovim</h2>
  <pre>
+-------------------+
| 1. Escribe tu código |
+-------------------+
          |
          v
+-----------------------------+
| 2. Crea/edita launch.json   |
+-----------------------------+
          |
          v
+-----------------------------+
| 3. Ejecuta :lua require('dap.ext.vscode').load_launchjs() |
+-----------------------------+
          |
          v
+-----------------------------+
| 4. Inicia depuración (<F5>) |
+-----------------------------+
          |
          v
+-----------------------------+
| 5. Usa breakpoints, step, etc. |
+-----------------------------+
          |
          v
+-----------------------------+
| 6. Analiza variables/logs   |
+-----------------------------+
    </pre>
  <h2>Ejemplo de launch.json para Python</h2>
  <pre>{
  "configurations": [
    {
      "type": "python",
      "request": "launch",
      "name": "Debug actual file",
      "program": "${file}",
      "console": "integratedTerminal"
    }
  ]
}</pre>
  <h2>Ejemplo para JavaScript (Node.js)</h2>
  <pre>{
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Debug JS",
      "program": "${file}",
      "cwd": "${workspaceFolder}"
    }
  ]
}</pre>
  <h2>Ejemplo para Java</h2>
  <pre>{
  "configurations": [
    {
      "type": "java",
      "request": "launch",
      "name": "Debug Java",
      "mainClass": "com.ejemplo.Main",
      "projectName": "MiProyecto"
    }
  ]
}</pre>
  <h2>Ejemplo para C++</h2>
  <pre>{
  "configurations": [
    {
      "name": "Debug C++",
      "type": "cppdbg",
      "request": "launch",
      "program": "${workspaceFolder}/a.out",
      "args": [],
      "stopAtEntry": false,
      "cwd": "${workspaceFolder}",
      "environment": [],
      "externalConsole": false,
      "MIMode": "gdb",
      "setupCommands": [
        { "description": "Enable pretty-printing", "text": "-enable-pretty-printing", "ignoreFailures": true }
      ]
    }
  ]
}</pre>
  <h2>Depuración remota, Docker y Docker Compose</h2>
  <ul>
    <li>Para depurar en Docker o por SSH, expón el puerto de debug (ej: 5678 para Python).</li>
    <li>Usa <b>pathMappings</b> para que los breakpoints funcionen correctamente:</li>
  </ul>
  <pre>{
  "type": "python",
  "request": "attach",
  "name": "Attach to remote",
  "port": 5678,
  "host": "localhost",
  "pathMappings": [
    {
      "localRoot": "${workspaceFolder}",
      "remoteRoot": "/app"
    }
  ]
}</pre>
  <h3>Tips para Docker Compose</h3>
  <ul>
    <li>Monta el código en la misma ruta en el contenedor y en tu máquina local.</li>
    <li>Ejemplo de servicio en <code>docker-compose.yml</code>:</li>
  </ul>
  <pre>services:
  app:
    build: .
    volumes:
      - ./:/app
    ports:
      - "5678:5678"
    command: ["python", "-m", "debugpy", "--listen", "0.0.0.0:5678", "main.py"]
</pre>
  <h3>Tips para SSH</h3>
  <ul>
    <li>Usa <code>ssh -L 5678:localhost:5678 usuario@servidor</code> para crear un túnel seguro.</li>
    <li>Verifica que el pathMapping apunte al path remoto correcto.</li>
  </ul>
  <h2>Errores comunes y solución</h2>
  <ul>
    <li><b>Breakpoint Unverified:</b> Verifica que los <code>pathMappings</code> sean correctos y que el código remoto coincida con el local.</li>
    <li>Revisa los logs con <code>:DapShowLog</code> para detalles de errores.</li>
    <li>Si usas Docker, monta el código en la misma ruta que en local para evitar problemas de paths.</li>
  </ul>
  <h2>Tips y buenas prácticas</h2>
  <ul>
    <li>Instala <b>nvim-dap</b> y los adaptadores para tu lenguaje (<b>nvim-dap-python</b>, <b>nvim-dap-js</b>, etc).</li>
    <li>Consulta la documentación de cada adaptador para configuraciones avanzadas.</li>
    <li>Usa mappings para iniciar, pausar, poner breakpoints y ver variables fácilmente.</li>
    <li>Siempre carga el <code>launch.json</code> antes de depurar.</li>
    <li>Para debugging remoto, asegúrate de que el puerto esté abierto y accesible.</li>
  </ul>
  <h2>Recursos útiles</h2>
  <ul>
    <li><a href="https://github.com/mfussenegger/nvim-dap" target="_blank">nvim-dap (GitHub)</a></li>
    <li><a href="https://github.com/mfussenegger/nvim-dap-python" target="_blank">nvim-dap-python</a></li>
    <li><a href="https://github.com/microsoft/vscode-js-debug" target="_blank">vscode-js-debug</a></li>
    <li><a href="https://github.com/mfussenegger/nvim-jdtls" target="_blank">nvim-jdtls (Java)</a></li>
    <li><a href="https://github.com/mfussenegger/nvim-dap/wiki/Debug-Adapter-installation" target="_blank">Wiki: instalación de adaptadores</a></li>
  </ul>
</section> 